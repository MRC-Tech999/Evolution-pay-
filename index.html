<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>MarcGPT V2</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
    h1 { margin-top: 20px; }
    .chat-box { width: 90%; max-width: 600px; background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px; }
    .message { display: flex; align-items: flex-start; margin-bottom: 15px; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
    .user .avatar { background: #007bff; }
    .bot .avatar { background: #28a745; }
    .text { background: #f1f1f1; padding: 10px 15px; border-radius: 8px; max-width: 80%; }
    .user .text { background: #dcf8c6; align-self: flex-end; }
    #userInput, button { width: 100%; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>MarcGPT V2</h1>

  <div class="chat-box" id="chatBox">
    <!-- Messages s'affichent ici -->
  </div>

  <div class="chat-box">
    <textarea id="userInput" rows="3" placeholder="Écris ta question ici..."></textarea>
    <button onclick="sendToMarcGPT()">Envoyer</button>
  </div>

  <script>
    async function sendToMarcGPT() {
      const input = document.getElementById('userInput');
      const message = input.value.trim();
      if (!message) return;

      appendMessage(message, 'user');
      input.value = '';

      appendMessage('Chargement...', 'bot');

      try {
        const res = await fetch('https://chatgpt-42.p.rapidapi.com/aitohuman', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-rapidapi-host': 'chatgpt-42.p.rapidapi.com',
            'x-rapidapi-key': 'ab42dda446mshde4ba65d25b85fdp13b83ejsn3965c0519b7d'
          },
          body: JSON.stringify({ text: message })
        });

        const data = await res.json();
        const botReply = data.output || 'Pas de réponse reçue.';
        
        removeLoading();
        appendMessage(botReply, 'bot');
        speakText(botReply);

      } catch (err) {
        removeLoading();
        appendMessage('Erreur : ' + err.message, 'bot');
      }
    }

    function appendMessage(text, sender) {
      const chatBox = document.getElementById('chatBox');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message ' + sender;

      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.textContent = sender === 'user' ? 'U' : 'M';

      const textDiv = document.createElement('div');
      textDiv.className = 'text';
      textDiv.textContent = text;

      messageDiv.appendChild(avatar);
      messageDiv.appendChild(textDiv);
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function removeLoading() {
      const chatBox = document.getElementById('chatBox');
      const lastMsg = chatBox.lastElementChild;
      if (lastMsg && lastMsg.classList.contains('bot') && lastMsg.querySelector('.text').textContent === 'Chargement...') {
        chatBox.removeChild(lastMsg);
      }
    }

    function speakText(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'fr-FR';
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>