<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Envoyer Message WhatsApp</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; }
    button { padding: 10px 20px; font-size: 16px; }
    #result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>WhatsApp Message avec Pièce Jointe</h1>

  <label>Numéro WhatsApp (ex : 33612345678) :</label>
  <input type="text" id="number" placeholder="Ex: 33612345678">

  <label>Message :</label>
  <textarea id="message" rows="4" placeholder="Votre message..."></textarea>

  <label>URL de la pièce jointe :</label>
  <input type="text" id="fileUrl" placeholder="https://example.com/image.jpg">

  <label>Nom du fichier :</label>
  <input type="text" id="fileName" placeholder="nom_du_fichier">

  <label>Type du fichier (png, pdf, jpeg...) :</label>
  <input type="text" id="fileType" placeholder="png">

  <button onclick="sendWhatsAppMessage()">Envoyer</button>

  <p id="result"></p>

  <script>
    async function sendWhatsAppMessage() {
      const rapidApiKey = "ab42dda446mshde4ba65d25b85fdp13b83ejsn3965c0519b7d"; // à sécuriser
      const keyApi = "95e2b258-0260-4272-8016-8d24054e14dd"; // à sécuriser
      const accountId = "50dd81b7-4e18-4c5a-ad7a-36c723ab955f"; // à sécuriser

      const to = document.getElementById("number").value.trim();
      const body = document.getElementById("message").value.trim();
      const url = document.getElementById("fileUrl").value.trim();
      const filename = document.getElementById("fileName").value.trim();
      const type = document.getElementById("fileType").value.trim();
      const resultEl = document.getElementById("result");

      if (!to || !body) {
        resultEl.textContent = "Le numéro et le message sont obligatoires.";
        return;
      }

      const payload = {
        account_id: accountId,
        to,
        body,
        attachment: url ? {
          url,
          filename: filename || "fichier",
          type: type || "png"
        } : undefined
      };

      try {
        const res = await fetch("https://whatsapp-private-api.p.rapidapi.com/v1/conversation", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "KeyApi": keyApi,
            "x-rapidapi-host": "whatsapp-private-api.p.rapidapi.com",
            "x-rapidapi-key": rapidApiKey
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        console.log(data);
        resultEl.textContent = data?.message || "Message envoyé (si l'API est connectée).";
      } catch (error) {
        console.error(error);
        resultEl.textContent = "Erreur lors de l'envoi du message.";
      }
    }
  </script>
</body>
</html>